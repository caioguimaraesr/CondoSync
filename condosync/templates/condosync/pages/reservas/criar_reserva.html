{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>CondoSync | Criar Reserva</title>
    <link rel="stylesheet" href="{% static 'condosync/css/style.css' %}">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <div class="container">
        <!-- side bar section start -->
        {% include "condosync/partials/sidebar.html" %}
        <!-- side bar section end -->

        <!-- main section start -->
        <main>
            <div class="dashboard">
                <i class='bx bxs-calendar-plus'></i>
                <h1>RESERVAS</h1>
            </div>

            <div class="form-reserva">
                <form method="POST">
                    {% csrf_token %}

                    <h1 style="display: flex; align-items: center; justify-content: center;"> Reservar {{ area.nome }}</h1>
                    <div class="form-group">
                        <label for="data">Data:</label>
                        <input type="date" name="data" id="data" data-area-id="{{ area.id }}" required>
                    </div>

                    <div class="form-group">
                        <label for="horario">Horário:</label>
                        <select name="horario" id="horario" required>
                            <option value="" disabled selected>Selecione um horário</option>
                            {% for horario in horarios %}
                                <option value="{{ horario.id }}">{{ horario }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-salvar">Confirmar Reserva</button>
                        <a href="{% url 'condosync:reservas' %}" class="btn btn-cancelar">Cancelar</a>
                    </div>
                </form>
            </div>
        </main>
        <!-- main section end -->

        <!-- right section start -->
        {% include "condosync/partials/right_section.html" %}
        <!-- right section end -->
    </div>

    <script>
    document.getElementById('data').addEventListener('change', function () {
        const dataSelecionada = this.value;
        const areaId = this.dataset.areaId;

        fetch(`/condosync/reservas/horarios_ocupados/?area_id=${areaId}&data=${dataSelecionada}`)
            .then(response => response.json())
            .then(ocupados => {
                const select = document.getElementById('horario');
                const options = select.options;

                for (let i = 0; i < options.length; i++) {
                    const option = options[i];
                    if (ocupados.includes(parseInt(option.value))) {
                        option.style.color = 'red';
                        option.disabled = true;
                    } else {
                        option.style.color = 'black';
                        option.disabled = false;
                    }
                }
            });
    });
    </script>
</body>
</html>
